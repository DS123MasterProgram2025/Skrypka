---
title: "Лабораторна робота №2. Розвідувальний аналіз даних."
author: ""
date: ""
output:
  html_notebook:
    toc: yes
    toc_float: true
    number_sections: yes
editor_options:
  chunk_output_type: inline
encoding: UTF-8
---
**Мета:** *Засвоєння принципів, знайомство з інструментами та набуття навичок експлораторного (розвідувального) аналізу даних засобами мови програмування R та колекції пакетів dplyr, ggplot2, desctable, "GGally", "corrplot", "PerformanceAnalytics", "FactoMineR", "factoextra", "funModeling", "desctable", "ade4", "psych", "smacof", "WVPlots", "caret", "car".*.

## Хід роботи

Об'єктом дослідження є вбудований датасет `CO2`, що містить результати експерименту з холодостійкості рослин виду *Echinochloa crus-galli*. Набір даних включає 84 спостереження та 5 змінних (факторні та числові).

Основні питання дослідження:
1. Оцінити якість та розподіл даних.
2. Визначити наявність кореляції між концентрацією `CO2` та поглинанням.
3. Виконати PCA для числових змінних та спробувати знайти паттерни (кластери) серед рослин різного походження.

### Підготовка та первинний огляд даних

Завантажимо необхідні бібліотеки та сам датасет.

```{r setup, message=FALSE, warning=FALSE}

library(tidyverse)  
library(corrplot)   
library(FactoMineR)
library(factoextra)

data(CO2)
eco_data <- as_tibble(CO2)

head(eco_data)
```

Переглянемо структуру даних та основні статистичні показники.

```{r}

glimpse(eco_data)

summary(eco_data)

```


## Аналіз описової статистики:

**Комплектність**: Пропущених значень (NA) немає. Датасет повний.

**Типи даних**: Маємо 3 категоріальні змінні (Plant, Type, Treatment) та 2 числові (conc, uptake).

**Діапазони**:

**conc** (концентрація `CO2`) варіюється від 95 до 1000 мл/л.
**uptake** (поглинання) варіюється від 7.7 до 45.5 мкмоль/м²с.

**Аномалії**: Нульові або від'ємні значення відсутні, що є логічним для фізичних вимірювань у цьому експерименті.

## Аналіз розподілу змінних

Побудуємо графіки щільності розподілу для числових змінних, щоб зрозуміти їхню природу.


```{r}

eco_data |>
  select(conc, uptake) |>
  pivot_longer(cols = everything(), names_to = "Variable", values_to = "Value") |>
  ggplot(aes(x = Value, fill = Variable)) +
  geom_density(alpha = 0.6, color = "black") +
  facet_wrap(~Variable, scales = "free") +
  scale_fill_manual(values = c("conc" = "#69b3a2", "uptake" = "#404080")) +
  theme_light() +
  labs(title = "Розподіл числових змінних", y = "Щільність", x = "Значення")

```

Що ми бачимо?

**1. **Розподіл `conc` є мультимодальним (має кілька піків). Це пояснюється дизайном експерименту: концентрація подавалася дискретними рівнями (95, 175, 250 і т.д.), а не була випадковою величиною.

**2. **Розподіл `uptake` нагадує нормальний, але дещо сплюснутий (плато). Це може свідчити про наявність кількох груп рослин, які по-різному реагують на умови (наприклад, різні типи походження).

## Аналіз кореляцій

Перевіримо, чи існує лінійний зв'язок між концентрацією вуглекислого газу та швидкістю його поглинання.

```{r}

cor_matrix <- cor(eco_data |> select(where(is.numeric)))

corrplot(cor_matrix, method = "number", type = "upper", 
         tl.col = "black", bg = "grey95", title = "Кореляція Пірсона", mar=c(0,0,1,0))

```

Висновки щодо кореляції: Коефіцієнт кореляції між `conc` та `uptake` становить 0.49. Це середній позитивний зв'язок. Тобто, зі збільшенням концентрації `CO2` поглинання зростає, але цей зв'язок не є ідеально лінійним (можливо, настає ефект насичення).

Щоб глибше зрозуміти природу даних, побудуємо діаграму розсіювання з розділенням за походженням рослин (`Type`).

```{r}

ggplot(eco_data, aes(x = conc, y = uptake, color = Type, shape = Treatment)) +
  geom_point(size = 3, alpha = 0.8) +
  geom_smooth(method = "loess", se = FALSE, size = 1) +
  scale_color_manual(values = c("Quebec" = "steelblue", "Mississippi" = "firebrick")) +
  theme_minimal() +
  labs(title = "Залежність поглинання від концентрації",
       subtitle = "В розрізі регіону походження та обробки холодом",
       x = "Концентрація CO2", y = "Поглинання (uptake)")

```


На графіку чітко видно, що рослини з Квебеку (сині) загалом мають вищий рівень поглинання, ніж рослини з Міссісіпі (червоні), особливо при високих концентраціях.

## Зниження розмірності (`PCA`)

Застосуємо метод головних компонент (`PCA`) до числових змінних. Хоча змінних лише дві, метод дозволить побачити, як вони формують загальну дисперсію та чи можна візуально розділити групи в новому просторі.


```{r}

res_pca <- PCA(eco_data |> select(conc, uptake), graph = FALSE, scale.unit = TRUE)

eig_val <- get_eigenvalue(res_pca)
knitr::kable(eig_val, caption = "Власні значення та пояснена дисперсія")

```

Інтерпретація: Перша компонента (Dim.1) пояснює 74.3% варіації даних, друга — 25.7%. Це означає, що більшу частину інформації про експеримент можна описати однією синтетичною змінною.

Подивимось на внесок змінних у компоненти:

```{r}

fviz_pca_var(res_pca, col.var = "contrib", 
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = TRUE)

```

Обидві змінні (`conc` та `uptake`) мають сильний позитивний внесок у першу вісь (Dim.1). Тобто, вісь X на графіку `PCA` фактично відображає "загальну інтенсивність процесу" (і концентрація висока, і поглинання високе).

## Кластеризація та сегментація у просторі PCA

Візуалізуємо індивідуальні виміри у просторі головних компонент, розфарбувавши їх за типом походження (`Type`), щоб відповісти на питання про однорідність груп.

```{r}
fviz_pca_ind(res_pca,
             geom.ind = "point", 
             pointshape = 21, 
             pointsize = 3,
             fill.ind = eco_data$Type, 
             col.ind = "black",        
             palette = c("Quebec" = "#2E9FDF", "Mississippi" = "#E7B800"),
             addEllipses = TRUE,       
             legend.title = "Регіон",
             title = "PCA: Групування за походженням рослин"
             )
```


Аналіз графіку `PCA`:

**Неоднорідність**: Групи `Quebec` та `Mississippi` не є повністю змішаними. Ми бачимо чітке зміщення центрів еліпсів.

**Розділення**: Рослини з Квебеку (сині) тяжіють вправо (до більших значень Dim.1), що підтверджує їхню вищу здатність до поглинання `CO2` порівняно з рослинами з `Міссісіпі`.

**Перекриття**: Існує значна зона перекриття, що свідчить про те, що при певних (низьких) концентраціях `CO2` поведінка рослин схожа незалежно від походження.

## Висновки

У ході лабораторної роботи було проведено аналіз датасету `CO2`.

**Дані**: Виявлено, що дані є комплектними. Розподіл концентрації дискретний, а поглинання має широкий діапазон варіації.

**Зв'язки**: Встановлено кореляцію (0.49) між концентрацією та поглинанням. Візуальний аналіз показав, що цей зв'язок сильніший для рослин з Квебеку.

**PCA**: Метод головних компонент дозволив спроектувати дані та підтвердити гіпотезу про неоднорідність вибірки. Рослини різних екотипів (`Quebec` vs `Mississippi`) утворюють різні, хоча й перекривні кластери. Фактор походження суттєво впливає на фізіологічні показники рослин.