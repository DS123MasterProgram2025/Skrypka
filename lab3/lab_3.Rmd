---
title: "Лабораторна робота №3. Побудова регресійних моделей"
author: ''
date: ""
output:
  html_notebook:
    toc: true
    toc_float: true
    number_sections: true
  html_document:
    toc: true
    df_print: paged
editor_options:
  chunk_output_type: inline
encoding: "UTF-8"
---
**Мета:** *Мета: Засвоєння базових принципів, знайомство з інструментами та набуття навичок побудови моделей регресії на рівні технології на основи статистичного підходу та моделей машинного навчання засобами мови програмування R та колекції пакетів `dplyr`, `ggplot2`.*

## Підготовка даних до аналізу

### Імпорт та попередній огляд

Як джерело даних використовується файл `hw.csv`, що містить інформацію про зріст, вагу та стать.

```{r setup, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(knitr)

library(readxl)
raw_data <- read_excel("data/hw.xlsx")

colnames(raw_data) <- c("Height", "Weight", "Gender")

glimpse(raw_data)
head(raw_data)
```

### Очищення та фільтрація

Далі необхідно дослідити залежність маси тіла від зросту для жінок. Також перевіримо дані на наявність аномальних викидів.

```{r}
women_df <- raw_data %>%
  filter(Gender == "Woman") %>%
  select(Height, Weight)

na_count <- sum(is.na(women_df))
cat("Кількість пропущених значень:", na_count, "\n")

summary(women_df)
```

Аналіз вибірки: В результаті фільтрації отримано набір даних, що містить тільки жінок. Середній зріст складає близько 165 см. Слід звернути увагу на максимальну вагу (можливо, є окремі викиди понад 100 кг), але для навчальної моделі ми залишимо ці дані як реальні спостереження.

## Розвідувальний аналіз (EDA)

Перед побудовою математичної моделі необхідно візуально оцінити форму залежності.

```{r}
ggplot(women_df, aes(x = Height, y = Weight)) +
  geom_point(color = "#2c3e50", alpha = 0.6, size = 2) + 
  geom_smooth(method = "lm", color = "#e74c3c", fill = "#ecf0f1") + 
  labs(
    title = "Кореляційне поле: Зріст vs Вага (Жінки)",
    subtitle = "Візуалізація лінійного тренду",
    x = "Зріст (см)",
    y = "Вага (кг)"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold"))
```


```{r}
cor_val <- cor(women_df$Height, women_df$Weight)
```

Інтерпретація: Графік демонструє чітку висхідну тенденцію. Коефіцієнт кореляції підтверджує наявність сильного прямого лінійного зв'язку між зростом та вагою.

## Побудова регресійної моделі

Створимо модель парної лінійної регресії

```{r}
linear_model <- lm(Weight ~ Height, data = women_df)

summary(linear_model)
```

Аналіз коефіцієнтів:

**Estimate (Height)**: Коефіцієнт при змінній зросту позитивний. Його значення вказує на те, на скільки кілограмів в середньому збільшується вага при збільшенні зросту на 1 см.

**R-squared**: Показує, яка частка варіації ваги пояснюється зростом. Значення вище 0.5 вважається прийнятним для біологічних даних.

**P-value**: Значення значно менше 0.05, що свідчить про статистичну значущість моделі.


## Прогнозування

Виконаємо прогноз ваги для заданих значень зросту (наприклад: 155, 165, 175 см) з розрахунком довірчих інтервалів.

```{r}
test_heights <- data.frame(Height = c(155, 165, 175))

predictions <- predict(linear_model, newdata = test_heights, interval = "confidence")

final_res <- cbind(test_heights, predictions)

kable(final_res, 
      col.names = c("Зріст (см)", "Прогноз ваги (кг)", "Нижня межа (95%)", "Верхня межа (95%)"),
      digits = 1,
      caption = "Таблиця 1. Результати прогнозування")
```

## Висновки

У ході лабораторної роботи на реальному датасеті hw було побудовано регресійну модель залежності ваги від зросту для жіночої статі. Встановлено, що зріст є значущим предиктором для ваги. Побудована модель адекватно описує загальну тенденцію, хоча наявність розкиду даних свідчить про вплив інших факторів, які не враховані у простій парній регресії.

